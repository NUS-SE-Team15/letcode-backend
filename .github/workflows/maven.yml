# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

name: Java CI with Maven

on:
  push:
    branches:
      - "main"
      - "lwj_user_auth"
      - "whq"
      - "yxr"
      - "zry"
  pull_request:
    branches:
      - "main"
      - "lwj_user_auth"
      - "whq"
      - "yxr"
      - "zry"

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4  # 检出代码

      # 设置 JDK 8 环境
      - name: Set up JDK 8
        uses: actions/setup-java@v4
        with:
          java-version: '8'
          distribution: 'temurin'  # 使用 temurin 作为 JDK 分发
          cache: maven             # 启用 Maven 缓存

      # 可选：关闭 Ubuntu 默认的 MySQL 服务
      - name: Shutdown Ubuntu MySQL (SUDO)
        run: sudo service mysql stop

      # 设置 MySQL 服务
      - name: Set up MySQL
        uses: mirromutth/mysql-action@v1.1
        with:
          mysql-version: '8.0'          # MySQL 版本
          root-password: '123456' # 设置 root 用户密码
          database: ''      # 数据库名称

      # 使用 Maven 构建项目
      - name: Build with Maven
        run: mvn -B package --file pom.xml

      # 可选：提交 Maven 依赖图到 GitHub，以便改进 Dependabot 提示
      - name: Update dependency graph
        uses: advanced-security/maven-dependency-submission-action@571e99aab1055c2e71a1e2309b9691de18d6b7d6